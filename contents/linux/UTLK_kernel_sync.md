内核抢占
=======
抢占的和非抢占是在描述一个kernel的特性。
无论是否是抢占的kernel，在内核态的进程都可以主动放弃CPU。
* 计划性进程切换（进程等某个资源，而主动进入休眠状态）
* 强制性进程切换（内核响应引起进程切换的异步事件）

抢占的内核：进程P1正在内核态执行，可以发生内核切换（P1被P2替换）
  优势：减少用户态进程分派的延迟
非抢占的内核：一个进程除非准备切回用户态，否则不会被替换

内核抢占可能发生在：
* 结束内核控制路径时
* 异常处理程序调用preempt_enable()重新允许内核抢占时
* 启用可延迟函数时

内核抢占是有开销的

临界区：一段代码，在其他内核控制路径，进入到到这段代码前，已经进去的控制路径必须全部执行完

同步原语
=======

* pre-cpu variable
* atomic
* barrier
* spinlock
* semaphore
* seqlock
* CRU
* disable local interrupt
* disable local soft-interrupt

pre-cpu variable
----------------

 CPU1  CPU2  CPU3
-------------------
|     |     |     |
-------------------